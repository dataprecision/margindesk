generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  id               String     @id @default(cuid())
  name             String
  zoho_contact_id  String?    @unique
  billing_currency String     @default("INR")
  gstin            String?
  pan              String?
  tags             String[]   @default([])
  created_at       DateTime   @default(now())
  updated_at       DateTime   @updatedAt
  doc_spaces       DocSpace[]
  projects         Project[]

  @@index([name])
  @@index([zoho_contact_id])
}

model Project {
  id                 String              @id @default(cuid())
  client_id          String
  name               String
  pricing_model      PricingModel?
  start_date         DateTime
  end_date           DateTime?
  status             ProjectStatus       @default(draft)
  zoho_project_id    String?             @unique
  created_at         DateTime            @default(now())
  updated_at         DateTime            @updatedAt
  accrual_lines      AccrualLine[]
  allocations        Allocation[]
  billing_plans      BillingPlan?
  doc_spaces         DocSpace[]
  invoices           Invoice[]
  purchase_orders    PO[]
  pod_mappings       PodProjectMapping[]
  client             Client              @relation(fields: [client_id], references: [id])
  config             ProjectConfig?
  project_costs      ProjectCost[]
  reselling_invoices ResellingInvoice[]
  timesheet_entries  TimesheetEntry[]

  @@index([client_id])
  @@index([status])
  @@index([start_date, end_date])
}

model ProjectConfig {
  id                 String        @id @default(cuid())
  project_id         String        @unique
  project_type       ProjectType
  billing_model      BillingModel
  rate_type          RateType
  blended_rate       Decimal?      @db.Decimal(10, 2)
  rate_card          Json?
  currency           String        @default("INR")
  billing_frequency  String        @default("monthly")
  hours_cap          Int?
  hours_cap_per_role Json?
  overage_policy     OveragePolicy @default(billable)
  po_amount          Decimal?      @db.Decimal(12, 2)
  po_valid_from      DateTime?
  po_valid_to        DateTime?
  product_id         String?
  created_at         DateTime      @default(now())
  updated_at         DateTime      @updatedAt
  project            Project       @relation(fields: [project_id], references: [id], onDelete: Cascade)
  product            Product?      @relation(fields: [product_id], references: [id])

  @@index([project_id])
  @@index([project_type])
}

model Person {
  id                  String               @id @default(cuid())
  email               String               @unique
  microsoft_user_id   String?              @unique
  name                String
  role                String
  department          String?
  billable            Boolean              @default(true)
  ctc_monthly         Decimal              @default(0) @db.Decimal(12, 2)
  utilization_target  Decimal              @default(0.80) @db.Decimal(5, 2)
  start_date          DateTime
  end_date            DateTime?
  manual_ctc_override Boolean              @default(false)
  manual_override_by  String?
  manual_override_at  DateTime?
  created_at          DateTime             @default(now())
  updated_at          DateTime             @updatedAt
  zoho_employee_id    String?              @unique
  manager_id          String?
  employee_code       String?              @unique
  allocations         Allocation[]
  expenses            Expense[]
  led_pods            FinancialPod[]       @relation("PodLeader")
  leaves              Leave[]
  managed_history     ManagerHistory[]     @relation("ManagerHistory")
  manager_history     ManagerHistory[]     @relation("EmployeeHistory")
  monthly_utilization MonthlyUtilization[]
  manager             Person?              @relation("ManagerReports", fields: [manager_id], references: [id])
  direct_reports      Person[]             @relation("ManagerReports")
  salary_records      PersonSalary[]
  pod_memberships     PodMembership[]
  timesheet_entries   TimesheetEntry[]

  @@index([email])
  @@index([billable])
  @@index([microsoft_user_id])
  @@index([zoho_employee_id])
  @@index([employee_code])
  @@index([department])
  @@index([manager_id])
}

model ManagerHistory {
  id         String    @id @default(cuid())
  person_id  String
  manager_id String
  start_date DateTime
  end_date   DateTime?
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  manager    Person    @relation("ManagerHistory", fields: [manager_id], references: [id], onDelete: Cascade)
  employee   Person    @relation("EmployeeHistory", fields: [person_id], references: [id], onDelete: Cascade)

  @@index([person_id])
  @@index([manager_id])
  @@index([person_id, start_date])
}

model PersonSalary {
  id               String   @id @default(cuid())
  person_id        String
  month            DateTime
  base_salary      Decimal  @db.Decimal(12, 2)
  bonus            Decimal  @default(0) @db.Decimal(12, 2)
  deductions       Decimal  @default(0) @db.Decimal(12, 2)
  overtime         Decimal  @default(0) @db.Decimal(12, 2)
  total            Decimal  @db.Decimal(12, 2)
  is_support_staff Boolean  @default(false)
  notes            String?
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  person           Person   @relation(fields: [person_id], references: [id], onDelete: Cascade)

  @@unique([person_id, month])
  @@index([person_id])
  @@index([month])
  @@index([is_support_staff])
}

model Leave {
  id            String      @id @default(cuid())
  person_id     String
  leave_type    String
  start_date    DateTime
  end_date      DateTime
  days          Decimal     @db.Decimal(6, 2)
  status        LeaveStatus @default(pending)
  reason        String?
  zoho_leave_id String?     @unique
  created_at    DateTime    @default(now())
  updated_at    DateTime    @updatedAt
  person        Person      @relation(fields: [person_id], references: [id], onDelete: Cascade)

  @@index([person_id, start_date])
  @@index([status])
}

model Holiday {
  id              String      @id @default(cuid())
  date            DateTime    @unique
  name            String
  type            HolidayType @default(public)
  description     String?
  zoho_holiday_id String?     @unique
  created_at      DateTime    @default(now())

  @@index([date])
  @@index([type])
}

model MonthlyUtilization {
  id                   String   @id @default(cuid())
  person_id            String
  month                DateTime
  working_hours        Decimal  @db.Decimal(6, 2)
  worked_hours         Decimal  @db.Decimal(6, 2)
  billable_hours       Decimal  @db.Decimal(6, 2)
  utilization_pct      Decimal  @db.Decimal(5, 2)
  billable_utilization Decimal  @db.Decimal(5, 2)
  leave_days           Decimal  @default(0) @db.Decimal(4, 2)
  holiday_days         Decimal  @default(0) @db.Decimal(4, 2)
  calculated_at        DateTime @default(now())
  updated_at           DateTime @updatedAt
  person               Person   @relation(fields: [person_id], references: [id], onDelete: Cascade)

  @@unique([person_id, month])
  @@index([month])
  @@index([utilization_pct])
}

model PO {
  id                    String   @id @default(cuid())
  project_id            String
  po_number             String   @unique
  currency              String   @default("INR")
  amount_total          Decimal  @db.Decimal(15, 2)
  valid_from            DateTime
  valid_to              DateTime
  zoho_purchaseorder_id String?  @unique
  status                POStatus @default(draft)
  amount_billed_to_date Decimal  @default(0) @db.Decimal(15, 2)
  amount_remaining      Decimal  @db.Decimal(15, 2)
  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt
  project               Project  @relation(fields: [project_id], references: [id])

  @@index([project_id])
  @@index([status])
  @@index([valid_from, valid_to])
}

model Allocation {
  id                String   @id @default(cuid())
  person_id         String
  project_id        String
  period_month      DateTime
  hours_billable    Decimal  @db.Decimal(6, 2)
  hours_nonbillable Decimal  @default(0) @db.Decimal(6, 2)
  pct_effort        Decimal  @db.Decimal(5, 2)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  person            Person   @relation(fields: [person_id], references: [id])
  project           Project  @relation(fields: [project_id], references: [id])

  @@unique([person_id, project_id, period_month])
  @@index([period_month])
  @@index([project_id, period_month])
}

model ProjectCost {
  id           String          @id @default(cuid())
  project_id   String
  period_month DateTime
  type         ProjectCostType
  amount       Decimal         @db.Decimal(12, 2)
  notes        String?
  created_at   DateTime        @default(now())
  updated_at   DateTime        @updatedAt
  project      Project         @relation(fields: [project_id], references: [id])

  @@unique([project_id, period_month, type])
  @@index([project_id, period_month])
}

model OverheadPool {
  id           String   @id @default(cuid())
  period_month DateTime @unique
  hr           Decimal  @default(0) @db.Decimal(12, 2)
  it           Decimal  @default(0) @db.Decimal(12, 2)
  admin        Decimal  @default(0) @db.Decimal(12, 2)
  rent         Decimal  @default(0) @db.Decimal(12, 2)
  mgmt         Decimal  @default(0) @db.Decimal(12, 2)
  misc         Decimal  @default(0) @db.Decimal(12, 2)
  notes        String?
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  @@index([period_month])
}

model OverheadPolicy {
  id           String         @id @default(cuid())
  period_month DateTime       @unique
  method       OverheadMethod
  params_json  Json
  approved_by  String?
  approved_at  DateTime?
  created_at   DateTime       @default(now())
  updated_at   DateTime       @updatedAt

  @@index([period_month])
}

model BillingPlan {
  id         String   @id @default(cuid())
  project_id String   @unique
  rule_json  Json
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  project    Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
}

model Invoice {
  id                 String             @id @default(cuid())
  project_id         String
  period_month       DateTime
  zoho_invoice_id    String?            @unique
  amount             Decimal            @db.Decimal(15, 2)
  issued_on          DateTime
  due_on             DateTime
  status             InvoiceStatus      @default(draft)
  sync_checksum      String?
  created_at         DateTime           @default(now())
  updated_at         DateTime           @updatedAt
  cash_receipts      CashReceipt[]
  project            Project            @relation(fields: [project_id], references: [id])
  reselling_invoices ResellingInvoice[]

  @@index([project_id, period_month])
  @@index([status])
  @@index([zoho_invoice_id])
}

model CashReceipt {
  id              String   @id @default(cuid())
  zoho_payment_id String?  @unique
  invoice_id      String
  received_on     DateTime
  amount          Decimal  @db.Decimal(15, 2)
  ref_no          String?
  payment_mode    String?
  created_at      DateTime @default(now())
  invoice         Invoice  @relation(fields: [invoice_id], references: [id])

  @@index([invoice_id])
  @@index([zoho_payment_id])
}

model ExpenseExclusionRule {
  id          String                       @id(map: "ExclusionRule_pkey") @default(cuid())
  name        String
  description String?
  enabled     Boolean                      @default(true)
  field       ExpenseExclusionRuleField
  operator    ExpenseExclusionRuleOperator
  value       String
  reason      String
  is_default  Boolean                      @default(false)
  created_at  DateTime                     @default(now())
  updated_at  DateTime                     @updatedAt

  @@index([enabled])
  @@index([is_default])
}

model Expense {
  id                     String        @id @default(cuid())
  zoho_expense_id        String?       @unique
  account_id             String?
  account_name           String?
  expense_date           DateTime
  amount                 Decimal       @db.Decimal(15, 2)
  total                  Decimal       @db.Decimal(15, 2)
  status                 ExpenseStatus @default(unbilled)
  is_billable            Boolean       @default(false)
  customer_id            String?
  customer_name          String?
  person_id              String?
  currency_code          String        @default("INR")
  description            String?
  reference_number       String?
  notes                  String?
  include_in_calculation Boolean       @default(true)
  exclusion_reason       String?
  tags                   String[]      @default([])
  created_at             DateTime      @default(now())
  updated_at             DateTime      @updatedAt
  person                 Person?       @relation(fields: [person_id], references: [id])

  @@index([zoho_expense_id])
  @@index([person_id])
  @@index([expense_date])
  @@index([status])
  @@index([include_in_calculation])
  @@index([tags])
}

model Bill {
  id                              String                      @id @default(cuid())
  zoho_bill_id                    String?                     @unique
  vendor_id                       String?
  vendor_name                     String
  bill_number                     String
  bill_date                       DateTime
  due_date                        DateTime?
  total                           Decimal                     @db.Decimal(15, 2)
  balance                         Decimal                     @db.Decimal(15, 2)
  status                          BillStatus                  @default(open)
  currency_code                   String                      @default("INR")
  reference_number                String?
  notes                           String?
  cf_expense_category             String?
  cf_expense_category_unformatted String?
  cf_billed_for_month             String?
  cf_billed_for_month_unformatted DateTime?
  include_in_calculation          Boolean                     @default(true)
  exclusion_reason                String?
  tags                            String[]                    @default([])
  created_at                      DateTime                    @default(now())
  updated_at                      DateTime                    @updatedAt
  sub_total                       Decimal?                    @db.Decimal(15, 2)
  tax_total                       Decimal?                    @default(0) @db.Decimal(15, 2)
  exchange_rate                   Decimal?                    @default(1) @db.Decimal(10, 6)
  tds_total                       Decimal?                    @default(0) @db.Decimal(15, 2)
  details_fetched_at              DateTime?
  details_sync_status             DetailsSyncStatus           @default(pending)
  line_items                      BillLineItem[]
  reselling_allocations           ResellingBillAllocation[]

  @@index([zoho_bill_id])
  @@index([vendor_id])
  @@index([bill_date])
  @@index([status])
  @@index([cf_expense_category])
  @@index([cf_billed_for_month_unformatted])
  @@index([include_in_calculation])
  @@index([tags])
  @@index([details_sync_status])
}

model BillLineItem {
  id                String   @id @default(cuid())
  bill_id           String
  zoho_line_item_id String?  @unique
  item_id           String?
  item_name         String
  account_id        String?
  account_name      String?
  description       String?
  quantity          Decimal  @db.Decimal(12, 4)
  rate              Decimal  @db.Decimal(15, 2)
  item_total        Decimal  @db.Decimal(15, 2)
  tax_percentage    Decimal  @default(0) @db.Decimal(5, 2)
  tax_amount        Decimal  @default(0) @db.Decimal(15, 2)
  tds_tax_amount    Decimal  @default(0) @db.Decimal(15, 2)
  customer_id       String?
  customer_name     String?
  tags              String[] @default([])
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  bill              Bill     @relation(fields: [bill_id], references: [id], onDelete: Cascade)

  @@index([bill_id])
  @@index([zoho_line_item_id])
  @@index([customer_id])
  @@index([item_id])
}

model AccrualSnapshot {
  id                   String                @id @default(cuid())
  period_month         DateTime              @unique
  status               AccrualSnapshotStatus @default(open)
  frozen_at            DateTime?
  frozen_by            String?
  version              Int                   @default(1)
  superseded_by        String?               @unique
  created_at           DateTime              @default(now())
  updated_at           DateTime              @updatedAt
  accrual_lines        AccrualLine[]
  superseding_snapshot AccrualSnapshot?      @relation("SnapshotVersion", fields: [superseded_by], references: [id])
  superseded_snapshot  AccrualSnapshot?      @relation("SnapshotVersion")
  journal_exports      JournalExport[]

  @@index([period_month, version])
  @@index([status])
}

model AccrualLine {
  id             String          @id @default(cuid())
  snapshot_id    String
  project_id     String
  earned_rev     Decimal         @db.Decimal(15, 2)
  invoiced_rev   Decimal         @db.Decimal(15, 2)
  unbilled_rev   Decimal         @db.Decimal(15, 2)
  deferred_rev   Decimal         @db.Decimal(15, 2)
  direct_cost    Decimal         @db.Decimal(15, 2)
  overhead_alloc Decimal         @db.Decimal(15, 2)
  gross_amt      Decimal         @db.Decimal(15, 2)
  gross_pct      Decimal         @db.Decimal(7, 4)
  net_amt        Decimal         @db.Decimal(15, 2)
  net_pct        Decimal         @db.Decimal(7, 4)
  at_risk_wip    Decimal         @db.Decimal(15, 2)
  created_at     DateTime        @default(now())
  project        Project         @relation(fields: [project_id], references: [id])
  snapshot       AccrualSnapshot @relation(fields: [snapshot_id], references: [id])

  @@unique([snapshot_id, project_id])
  @@index([project_id])
}

model JournalExport {
  id          String            @id @default(cuid())
  snapshot_id String
  type        JournalExportType
  file_url    String
  created_at  DateTime          @default(now())
  snapshot    AccrualSnapshot   @relation(fields: [snapshot_id], references: [id])

  @@index([snapshot_id])
}

model DocSpace {
  id             String        @id @default(cuid())
  project_id     String?
  client_id      String?
  title          String
  category       DocCategory
  version        String
  file_url       String
  sha256         String
  signed         Boolean       @default(false)
  signed_by      String?
  signed_at      DateTime?
  retention_till DateTime?
  access_tier    DocAccessTier @default(restricted)
  tags           String[]      @default([])
  status         DocStatus     @default(draft)
  created_at     DateTime      @default(now())
  updated_at     DateTime      @updatedAt
  approvals      Approval[]
  client         Client?       @relation(fields: [client_id], references: [id])
  project        Project?      @relation(fields: [project_id], references: [id])

  @@index([project_id])
  @@index([client_id])
  @@index([category])
  @@index([status])
  @@index([retention_till])
}

model Approval {
  id          String            @id @default(cuid())
  docspace_id String
  step        Int
  approver_id String
  decision    ApprovalDecision?
  decided_at  DateTime?
  comment     String?
  created_at  DateTime          @default(now())
  docspace    DocSpace          @relation(fields: [docspace_id], references: [id], onDelete: Cascade)

  @@unique([docspace_id, step])
  @@index([approver_id])
}

model AuditLog {
  id          String   @id @default(cuid())
  actor_id    String
  entity      String
  entity_id   String
  action      String
  before_json Json?
  after_json  Json?
  at          DateTime @default(now())

  @@index([entity, entity_id])
  @@index([actor_id])
  @@index([at])
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  name          String?
  password      String?  // Nullable for OAuth users
  auth_provider String   @default("microsoft") // "microsoft" or "credentials"
  role          UserRole @default(readonly)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  @@index([email])
  @@index([role])
  @@index([auth_provider])
}

model SyncLog {
  id             String    @id @default(cuid())
  sync_type      String
  status         String
  started_at     DateTime  @default(now())
  completed_at   DateTime?
  records_synced Int       @default(0)
  error_message  String?
  metadata       Json?

  @@index([sync_type, started_at])
  @@index([status])
}

model IntegrationSettings {
  id         String   @id @default(cuid())
  key        String   @unique
  config     Json
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([key])
}

model FinancialPod {
  id          String              @id @default(cuid())
  name        String
  description String?
  leader_id   String
  status      PodStatus           @default(active)
  created_at  DateTime            @default(now())
  updated_at  DateTime            @updatedAt
  leader      Person              @relation("PodLeader", fields: [leader_id], references: [id])
  members     PodMembership[]
  projects    PodProjectMapping[]

  @@index([leader_id])
  @@index([status])
}

model PodMembership {
  id             String       @id @default(cuid())
  pod_id         String
  person_id      String
  start_date     DateTime
  end_date       DateTime?
  allocation_pct Int          @default(100)
  created_at     DateTime     @default(now())
  updated_at     DateTime     @updatedAt
  person         Person       @relation(fields: [person_id], references: [id], onDelete: Cascade)
  pod            FinancialPod @relation(fields: [pod_id], references: [id], onDelete: Cascade)

  @@unique([pod_id, person_id, start_date])
  @@index([person_id, end_date])
  @@index([pod_id, end_date])
}

model PodProjectMapping {
  id         String       @id @default(cuid())
  pod_id     String
  project_id String
  start_date DateTime
  end_date   DateTime?
  created_at DateTime     @default(now())
  updated_at DateTime     @updatedAt
  pod        FinancialPod @relation(fields: [pod_id], references: [id], onDelete: Cascade)
  project    Project      @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@unique([pod_id, project_id, start_date])
  @@index([project_id, end_date])
  @@index([pod_id, end_date])
}

model BillExclusionRule {
  id          String                    @id @default(cuid())
  name        String
  description String?
  enabled     Boolean                   @default(true)
  field       BillExclusionRuleField
  operator    BillExclusionRuleOperator
  value       String
  reason      String
  is_default  Boolean                   @default(false)
  created_at  DateTime                  @default(now())
  updated_at  DateTime                  @updatedAt

  @@index([enabled])
  @@index([is_default])
}

model DetailSyncJob {
  id              String    @id @default(cuid())
  filter_type     String
  filter_value    String
  status          JobStatus @default(running)
  total_bills     Int       @default(0)
  processed_bills Int       @default(0)
  success_count   Int       @default(0)
  error_count     Int       @default(0)
  force_refetch   Boolean   @default(false)
  error_messages  String[]  @default([])
  started_at      DateTime  @default(now())
  completed_at    DateTime?
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt

  @@index([status])
  @@index([started_at])
  @@index([filter_type, filter_value])
}

model TimesheetEntry {
  id              String               @id @default(cuid())
  person_id       String
  project_id      String
  work_date       DateTime
  task_name       String?
  task_type       String?
  hours_logged    Decimal              @db.Decimal(5, 2)
  notes           String?
  import_batch_id String
  source_row_hash String
  created_at      DateTime             @default(now())
  updated_at      DateTime             @updatedAt
  is_billable     Boolean              @default(false)
  import_batch    TimesheetImportBatch @relation(fields: [import_batch_id], references: [id], onDelete: Cascade)
  person          Person               @relation(fields: [person_id], references: [id])
  project         Project              @relation(fields: [project_id], references: [id])

  @@unique([person_id, project_id, work_date, source_row_hash])
  @@index([work_date])
  @@index([person_id, work_date])
  @@index([project_id, work_date])
  @@index([import_batch_id])
}

model TimesheetImportBatch {
  id              String           @id @default(cuid())
  imported_by     String
  file_name       String
  period_start    DateTime
  period_end      DateTime
  total_rows      Int
  processed_rows  Int
  skipped_rows    Int
  deleted_entries Int              @default(0)
  error_messages  String[]         @default([])
  created_at      DateTime         @default(now())
  entries         TimesheetEntry[]

  @@index([created_at])
  @@index([period_start, period_end])
}

model Product {
  id                   String                      @id @default(cuid())
  name                 String                      @unique
  type                 ProductType
  is_predefined        Boolean                     @default(false)
  description          String?
  created_at           DateTime                    @default(now())
  updated_at           DateTime                    @updatedAt
  reselling_invoices   ResellingInvoice[]
  bill_allocations     ResellingBillAllocation[]
  project_configs      ProjectConfig[]

  @@index([type])
  @@index([is_predefined])
}

model ResellingInvoice {
  id                 String                      @id @default(cuid())
  project_id         String
  product_id         String
  invoice_id         String?
  period_month       DateTime
  invoice_number     String?
  invoice_date       DateTime
  invoice_amount     Decimal                     @db.Decimal(15, 2)
  total_oem_cost     Decimal                     @default(0) @db.Decimal(15, 2)
  resource_cost      Decimal                     @default(0) @db.Decimal(15, 2)
  other_expenses     Decimal                     @default(0) @db.Decimal(15, 2)
  total_cost         Decimal                     @default(0) @db.Decimal(15, 2)
  gross_profit       Decimal                     @default(0) @db.Decimal(15, 2)
  profit_margin_pct  Decimal                     @default(0) @db.Decimal(5, 2)
  notes              String?
  created_at         DateTime                    @default(now())
  updated_at         DateTime                    @updatedAt
  project            Project                     @relation(fields: [project_id], references: [id], onDelete: Cascade)
  product            Product                     @relation(fields: [product_id], references: [id])
  invoice            Invoice?                    @relation(fields: [invoice_id], references: [id])
  bill_allocations   ResellingBillAllocation[]

  @@index([project_id, period_month])
  @@index([product_id, period_month])
  @@index([invoice_id])
  @@index([period_month])
}

model ResellingBillAllocation {
  id                    String           @id @default(cuid())
  reselling_invoice_id  String
  bill_id               String
  product_id            String
  allocation_percentage Decimal          @db.Decimal(5, 2)
  allocated_amount      Decimal          @db.Decimal(15, 2)
  notes                 String?
  created_at            DateTime         @default(now())
  updated_at            DateTime         @updatedAt
  reselling_invoice     ResellingInvoice @relation(fields: [reselling_invoice_id], references: [id], onDelete: Cascade)
  bill                  Bill             @relation(fields: [bill_id], references: [id])
  product               Product          @relation(fields: [product_id], references: [id])

  @@unique([reselling_invoice_id, bill_id])
  @@index([bill_id])
  @@index([product_id])
}

enum ProductType {
  reselling
  outsourcing
  custom
}

enum PodStatus {
  active
  inactive
  archived
}

enum PricingModel {
  TnM
  Retainer
  Milestone
}

enum ProjectStatus {
  draft
  active
  on_hold
  completed
  cancelled
}

enum ProjectType {
  hourly_blended
  hourly_resource_based
  reselling
  outsourcing
}

enum BillingModel {
  time_and_material
}

enum RateType {
  blended
  role_based
}

enum OveragePolicy {
  billable
  absorbed
}

enum LeaveStatus {
  pending
  approved
  rejected
  cancelled
}

enum HolidayType {
  public
  restricted
  optional
}

enum POStatus {
  draft
  active
  expired
  closed
}

enum ProjectCostType {
  tool
  travel
  contractor
  other
}

enum OverheadMethod {
  per_head
  rev_pct
  direct_cost_pct
  hybrid
}

enum InvoiceStatus {
  draft
  sent
  paid
  void
}

enum ExpenseStatus {
  unbilled
  invoiced
  reimbursed
  billable
  non_billable
}

enum ExpenseExclusionRuleField {
  account_name
  description
  customer_name
  amount
  notes
}

enum ExpenseExclusionRuleOperator {
  equals
  contains
  starts_with
  ends_with
  greater_than
  less_than
}

enum BillExclusionRuleField {
  vendor_name
  bill_number
  account_name
  description
  notes
  cf_expense_category
  total
}

enum BillExclusionRuleOperator {
  equals
  contains
  contains_any_of
  starts_with
  ends_with
  greater_than
  less_than
}

enum BillStatus {
  draft
  open
  overdue
  paid
  void
}

enum AccrualSnapshotStatus {
  open
  frozen
}

enum JournalExportType {
  unbilled
  deferred
  reversal
}

enum DocCategory {
  PO
  MSA
  SOW
  NDA
  Policy
  SOP
  Audit
}

enum DocAccessTier {
  public
  restricted
  legal
}

enum DocStatus {
  draft
  active
  obsolete
}

enum ApprovalDecision {
  approved
  rejected
}

enum UserRole {
  owner
  finance
  pm
  readonly
}

enum DetailsSyncStatus {
  pending
  syncing
  synced
  error
}

enum JobStatus {
  running
  completed
  failed
  cancelled
}
